<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Task Master - Mobile Fix</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #0f111a;
            font-family: 'Outfit', sans-serif;
            min-height: 100vh;
            overflow-x: hidden; /* Zapobiega przewijaniu na boki */
        }

        /* T≈ÅO AURORA */
        .aurora-blob {
            position: absolute;
            filter: blur(80px);
            z-index: -1;
            opacity: 0.6;
            animation: float 10s infinite ease-in-out;
        }
        .blob-1 { top: -10%; left: -10%; width: 500px; height: 500px; background: #7c3aed; animation-delay: 0s; }
        .blob-2 { top: 20%; right: -10%; width: 400px; height: 400px; background: #db2777; animation-delay: 2s; }
        .blob-3 { bottom: -10%; left: 20%; width: 600px; height: 600px; background: #2563eb; animation-delay: 4s; }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(20px, -20px) scale(1.1); }
        }

        .glass-panel {
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        .task-enter { animation: slideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* Ukryj scrollbar ale zachowaj funkcjonalno≈õƒá */
        ::-webkit-scrollbar { width: 0px; background: transparent; }
    </style>
</head>
<body class="flex items-start justify-center p-4 pt-16 sm:pt-20 text-slate-200">

    <div class="aurora-blob blob-1"></div>
    <div class="aurora-blob blob-2"></div>
    <div class="aurora-blob blob-3"></div>

    <div id="syncStatus" class="fixed top-4 right-4 flex items-center gap-2 px-3 py-1.5 rounded-full glass-panel text-xs font-bold transition-all z-50">
        <span class="w-2 h-2 rounded-full bg-slate-500"></span>
        <span class="tracking-wide uppercase text-[10px]">Gotowy</span>
    </div>

    <div class="w-full max-w-2xl relative">
        
        <div class="text-center mb-8">
            <h1 class="text-5xl sm:text-6xl font-bold text-white mb-2 tracking-tight drop-shadow-xl">
                Task<span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400">Master</span>
            </h1>
            <div class="flex items-center justify-center gap-4 mt-4">
                <button id="refreshBtn" class="group flex items-center gap-2 px-4 py-2 rounded-full glass-panel hover:bg-white/5 border border-white/10 transition-all text-sm font-medium text-slate-300 hover:text-white hover:border-purple-500/50">
                    <svg class="w-4 h-4 text-purple-400 transition-transform group-hover:rotate-180 duration-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                    Synchronizuj
                </button>
            </div>
        </div>

        <div class="glass-panel rounded-3xl p-4 sm:p-6 mb-8 relative group overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-r from-purple-500/10 to-pink-500/10 opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"></div>

            <div class="relative z-10">
                <div class="flex flex-col sm:flex-row gap-3 mb-4 sm:mb-5">
                    <input type="text" id="taskInput" placeholder="Co planujesz zrobiƒá?" 
                        class="flex-1 bg-slate-900/60 text-white placeholder-slate-500 rounded-2xl px-5 py-4 outline-none focus:ring-2 focus:ring-purple-500/50 transition-all border border-slate-700/50 hover:border-slate-600 shadow-inner w-full">
                    
                    <button id="addBtn" class="w-full sm:w-auto bg-gradient-to-br from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white rounded-2xl px-6 py-3 sm:py-0 font-semibold transition-all shadow-lg shadow-purple-900/40 active:scale-95 flex items-center justify-center gap-2">
                        <span class="sm:hidden">Dodaj zadanie</span> <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 4v16m8-8H4"/>
                        </svg>
                    </button>
                </div>
                
                <div class="grid grid-cols-3 gap-2 sm:gap-3">
                    <button class="p-btn py-2.5 rounded-xl text-xs sm:text-sm font-medium border border-transparent transition-all bg-slate-800/50 text-slate-400 hover:bg-slate-700/50" data-p="high">üî• Pilne</button>
                    <button class="p-btn py-2.5 rounded-xl text-xs sm:text-sm font-medium border border-transparent transition-all bg-slate-800/50 text-slate-400 hover:bg-slate-700/50" data-p="medium">‚≠ê Wa≈ºne</button>
                    <button class="p-btn py-2.5 rounded-xl text-xs sm:text-sm font-medium border border-transparent transition-all bg-slate-800/50 text-slate-400 hover:bg-slate-700/50" data-p="low">‚òï Luz</button>
                </div>
            </div>
        </div>

        <div id="taskList" class="space-y-3 sm:space-y-4 pb-24">
            <div class="text-center py-12 opacity-40">
                <p class="text-lg font-light tracking-wide">Pobieranie Twoich plan√≥w...</p>
            </div>
        </div>
    </div>

<script>
    // ==========================================
    // KLUCZE API
    // ==========================================
    const BIN_ID = '694b89db43b1c97be90213d7'; 
    const API_KEY = '$2a$10$JSk4K56EtQw7N9T/bE9EWOLV8NHEaiTWxIrbhmSz2MO9LPQU4cuN6'; 
    // ==========================================

    const API_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;
    
    let tasks = [];
    let currentPriority = 'high';
    let isSaving = false;

    const styles = {
        high:   { 
            border: 'border-l-4 border-l-rose-500', 
            bg: 'bg-gradient-to-r from-rose-500/5 to-transparent',
            badge: 'bg-rose-500/10 text-rose-400 border border-rose-500/20'
        },
        medium: { 
            border: 'border-l-4 border-l-amber-400', 
            bg: 'bg-gradient-to-r from-amber-400/5 to-transparent',
            badge: 'bg-amber-400/10 text-amber-300 border border-amber-400/20'
        },
        low:    { 
            border: 'border-l-4 border-l-emerald-400', 
            bg: 'bg-gradient-to-r from-emerald-400/5 to-transparent',
            badge: 'bg-emerald-400/10 text-emerald-300 border border-emerald-400/20'
        }
    };

    async function loadFromCloud() {
        if (isSaving) return;
        updateStatus('loading');

        try {
            const res = await fetch(API_URL + '/latest', {
                headers: { 'X-Master-Key': API_KEY }
            });

            if (!res.ok) throw new Error('B≈ÇƒÖd klucza lub ID');

            const data = await res.json();
            tasks = data.record.tasks || [];
            render();
            updateStatus('online');
        } catch (e) {
            console.error(e);
            updateStatus('error');
            if(tasks.length === 0) {
                document.getElementById('taskList').innerHTML = `<div class="glass-panel p-6 rounded-2xl text-center text-rose-400">Problem z po≈ÇƒÖczeniem.</div>`;
            }
        }
    }

    async function saveToCloud() {
        isSaving = true;
        updateStatus('saving');

        try {
            const res = await fetch(API_URL, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Master-Key': API_KEY
                },
                body: JSON.stringify({ tasks: tasks })
            });

            if (res.ok) {
                updateStatus('saved');
                setTimeout(() => updateStatus('online'), 2000);
            } else {
                throw new Error('Save failed');
            }
        } catch (e) {
            console.error(e);
            updateStatus('error');
            alert("B≈ÇƒÖd zapisu! Sprawd≈∫ po≈ÇƒÖczenie.");
        } finally {
            isSaving = false;
        }
    }

    function addTask() {
        const input = document.getElementById('taskInput');
        const text = input.value.trim();
        if (!text) return;

        tasks.unshift({
            id: Date.now(),
            text: text,
            priority: currentPriority,
            completed: false
        });

        input.value = '';
        render();
        saveToCloud();
    }

    function toggleTask(id) {
        const task = tasks.find(t => t.id === id);
        if (task) {
            task.completed = !task.completed;
            render();
            saveToCloud();
        }
    }

    function removeTask(id) {
        if(confirm('UsunƒÖƒá to zadanie?')) {
            tasks = tasks.filter(t => t.id !== id);
            render();
            saveToCloud();
        }
    }

    function render() {
        const list = document.getElementById('taskList');
        if (tasks.length === 0) {
            list.innerHTML = `
                <div class="text-center py-16 opacity-50">
                    <svg class="w-16 h-16 mx-auto mb-4 text-slate-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                    </svg>
                    <p class="text-lg">Wszystko zrobione!</p>
                </div>`;
            return;
        }

        const sortedTasks = [...tasks].sort((a, b) => a.completed - b.completed);

        list.innerHTML = sortedTasks.map(t => {
            const style = styles[t.priority];
            return `
            <div class="glass-panel group relative flex items-center gap-4 p-4 sm:p-5 rounded-2xl transition-all duration-300 task-enter ${style.border} ${style.bg} ${t.completed ? 'opacity-50 grayscale' : 'hover:bg-white/5'}">
                
                <button onclick="toggleTask(${t.id})" 
                    class="relative flex-shrink-0 w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all duration-300 ${t.completed ? 'bg-purple-500 border-purple-500 scale-110' : 'border-slate-500 hover:border-purple-400'}">
                    ${t.completed ? '<svg class="w-3.5 h-3.5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3.5"><path d="M5 13l4 4L19 7"/></svg>' : ''}
                </button>
                
                <span class="flex-1 text-sm sm:text-[15px] font-medium leading-relaxed break-words ${t.completed ? 'line-through text-slate-500' : 'text-slate-100'}">
                    ${t.text}
                </span>
                
                <div class="flex items-center gap-2 sm:gap-3 flex-shrink-0">
                    <span class="text-[9px] sm:text-[10px] uppercase tracking-wider font-bold px-2 py-1 rounded-lg ${style.badge}">
                        ${t.priority === 'high' ? 'Pilne' : t.priority === 'medium' ? 'Wa≈ºne' : 'Luz'}
                    </span>
                    
                    <button onclick="removeTask(${t.id})" class="text-slate-500 hover:text-rose-400 transition-colors p-1.5 rounded-lg hover:bg-rose-500/10 opacity-100 sm:opacity-0 sm:group-hover:opacity-100">
                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                    </button>
                </div>
            </div>
            `;
        }).join('');
    }

    function updateStatus(state) {
        const el = document.getElementById('syncStatus');
        const dot = el.querySelector('span');
        const txt = el.querySelectorAll('span')[1];

        if (state === 'online') {
            dot.className = 'w-2 h-2 rounded-full bg-emerald-400 shadow-[0_0_8px_rgba(52,211,153,0.6)]';
            txt.innerText = 'Gotowy';
            txt.className = 'tracking-wide uppercase text-[10px] text-emerald-400';
            el.className = 'fixed top-4 right-4 flex items-center gap-2 px-3 py-1.5 rounded-full glass-panel border-emerald-500/20 z-50';
        } else if (state === 'saving') {
            dot.className = 'w-2 h-2 rounded-full border-2 border-blue-400 border-t-transparent animate-spin';
            txt.innerText = 'Wysy≈Çanie...';
            txt.className = 'tracking-wide uppercase text-[10px] text-blue-400';
        } else if (state === 'loading') {
            dot.className = 'w-2 h-2 rounded-full border-2 border-purple-400 border-t-transparent animate-spin';
            txt.innerText = '≈Åadowanie...';
            txt.className = 'tracking-wide uppercase text-[10px] text-purple-400';
        } else if (state === 'saved') {
            txt.innerText = 'Zapisano!';
        } else if (state === 'error') {
            dot.className = 'w-2 h-2 rounded-full bg-rose-500';
            txt.innerText = 'B≈ÇƒÖd';
            txt.className = 'tracking-wide uppercase text-[10px] text-rose-400';
        }
    }

    document.getElementById('addBtn').addEventListener('click', addTask);
    document.getElementById('taskInput').addEventListener('keypress', e => e.key === 'Enter' && addTask());
    
    document.getElementById('refreshBtn').addEventListener('click', function() {
        const icon = this.querySelector('svg');
        icon.classList.add('animate-spin');
        loadFromCloud().then(() => {
            setTimeout(() => icon.classList.remove('animate-spin'), 500);
        });
    });

    document.querySelectorAll('.p-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            currentPriority = this.dataset.p;
            document.querySelectorAll('.p-btn').forEach(b => {
                b.className = 'p-btn py-2.5 rounded-xl text-xs sm:text-sm font-medium border border-transparent transition-all bg-slate-800/50 text-slate-400 hover:bg-slate-700/50';
            });
            let activeClass = '';
            if(currentPriority === 'high') activeClass = 'bg-rose-500 text-white shadow-lg shadow-rose-500/20';
            if(currentPriority === 'medium') activeClass = 'bg-amber-500 text-white shadow-lg shadow-amber-500/20';
            if(currentPriority === 'low') activeClass = 'bg-emerald-500 text-white shadow-lg shadow-emerald-500/20';
            this.className = `p-btn py-2.5 rounded-xl text-xs sm:text-sm font-medium transition-all transform scale-105 ${activeClass}`;
        });
    });

    document.querySelector('[data-p="high"]').click();
    loadFromCloud();

</script>
</body>
</html>